---
layout: post
title:  "Spark QA"
date:   2016-08-23
categories: BigData
excerpt: 
tags: Spark Useful QA
---

* content
{:toc}

## log4j

Spark loads its default log4j properties, and some information is hidden.

To change this, you can define your own [log4j.properties](https://gist.github.com/SeaOfOcean/d7e7e43411801114072f4e7edbc3c8d1)

And the "standard placement" for this is 

```
src/main/resources
src/test/resources
```

The folder structure is as follows:

![log4j folder structure](/images/posts/log4j.png)

Now it works!

## Submit spark job

First you need to build your spark source by running 

```
./build/mvn -DskipTests clean package
```

Then you can set your SPARK_HOME in .bashrc for easy access

```
export SPARK_HOME=$HOME/Downloads/spark-1.6.2
export PATH=$PATH:$SPARK_HOME/bin
```

Then you can package your project using maven. Similar to spark package.
The packaged jar can be found in ```target``` folder.

To submit the spark application, you can reference [this guide](http://spark.apache.org/docs/latest/submitting-applications.html#submitting-applications).

For reusable purpose, you can write a script like 

```
#!/bin/bash

TargetJar=target/ie-project-1.0-SNAPSHOT-jar-with-dependencies.jar
MainClass=org.apache.spark.sql.RelationEvaluation


$SPARK_HOME/bin/spark-submit \
  --class $MainClass \
  --driver-memory 10G \
  --jars lib/stanford-corenlp.jar,lib/stanford-english-corenlp-models-current.jar \
  $TargetJar -d

```
Note that by default all dependency jars will be packaged into single fat jar, 
except those system jars or provided jars. The reason is explained in [this post]({% post.url/useful staff/2016-08-23-maven})

In this way, you can run your spark application locally.

And other type may be similar and I'll try these days.

Note that the driver-memory need to be set, otherwise will easily get out of memory error. Need to know why!


